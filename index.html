<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Entradas Automático</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #000; padding: 8px; text-align: left; }
  h3 { margin-top: 30px; }
  .ativo { color: green; font-weight: bold; }
  td[contenteditable="true"] { background-color: #f9f9f9; }
  .data { cursor: pointer; background: #eef; }
</style>
</head>
<body>

<h2>Histórico de Entradas</h2>

<table id="tabelaEntradas">
  <tr>
    <th>Data</th>
    <th>Tipo</th>
    <th>Valor</th>
    <th>Tempo</th>
  </tr>
  <tr>
    <td class="data"></td>
    <td class="ativo">Andriele INSS</td>
    <td contenteditable="true"></td>
    <td class="cronometro">00:00:00</td>
  </tr>
  <tr>
    <td class="data"></td>
    <td class="ativo">Marco INSS</td>
    <td contenteditable="true"></td>
    <td class="cronometro">00:00:00</td>
  </tr>
  <tr>
    <td class="data"></td>
    <td class="ativo">Marco Obra</td>
    <td contenteditable="true"></td>
    <td class="cronometro">00:00:00</td>
  </tr>
  <tr>
    <td class="data"></td>
    <td class="ativo">Lorena Fixada</td>
    <td contenteditable="true"></td>
    <td class="cronometro">00:00:00</td>
  </tr>
  <tr>
    <td class="data"></td>
    <td class="ativo">Davi Azulejista</td>
    <td contenteditable="true"></td>
    <td class="cronometro">00:00:00</td>
  </tr>
</table>

<h3>Totais</h3>
<ul id="totais">
  <li id="somaTotal" style="font-weight:bold;">Soma Total: R$ 0.00</li>
</ul>

<script>
// === Preenche data atual ===
function formatarData(d) {
  return d.toLocaleDateString('pt-BR');
}
document.querySelectorAll('.data').forEach(cell => {
  cell.innerText = formatarData(new Date());
});

// === Clique na data abre calendário ===
document.querySelectorAll('.data').forEach(cell => {
  cell.addEventListener('click', () => {
    const input = document.createElement("input");
    input.type = "date";
    input.style.position = "absolute";
    input.style.left = cell.getBoundingClientRect().left + "px";
    input.style.top = cell.getBoundingClientRect().top + "px";
    input.style.zIndex = 1000;

    // Quando selecionar uma data
    input.addEventListener("change", () => {
      const escolhida = new Date(input.value);
      cell.innerText = formatarData(escolhida);
      document.body.removeChild(input);
    });

    // Se sair sem escolher
    input.addEventListener("blur", () => {
      document.body.removeChild(input);
    });

    document.body.appendChild(input);
    input.focus();
    input.click();
  });
});

// === Cronômetro ===
const linhasCronometro = document.querySelectorAll('.cronometro');
const inicios = [];
linhasCronometro.forEach(linha => inicios.push(new Date()));

function formatarTempo(segundos) {
  const h = String(Math.floor(segundos / 3600)).padStart(2,'0');
  const m = String(Math.floor((segundos % 3600) / 60)).padStart(2,'0');
  const s = String(segundos % 60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

setInterval(() => {
  const agora = new Date();
  linhasCronometro.forEach((linha, i) => {
    const segundosPassados = Math.floor((agora - inicios[i])/1000);
    linha.innerText = formatarTempo(segundosPassados);
  });
}, 1000);

// === Soma automática ===
const valoresCells = document.querySelectorAll('td[contenteditable="true"]');
const somaTotalElem = document.getElementById('somaTotal');

function atualizarSoma() {
  let soma = 0;
  valoresCells.forEach(cell => {
    const valor = parseFloat(cell.innerText.replace(',', '.'));
    if(!isNaN(valor)) soma += valor;
  });
  somaTotalElem.innerText = `Soma Total: R$ ${soma.toFixed(2)}`;
}
valoresCells.forEach(cell => {
  cell.addEventListener('input', atualizarSoma);
});
</script>

</body>
</html>
